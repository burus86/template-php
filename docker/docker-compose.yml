version: "3.7"
services:
  php:
    container_name: template-php
    build: .
    ports:
      - 8080:8080
    volumes:
      - ../:/var/www/
    networks:
      - base
    secrets:
      - host_ssh_key
    command: symfony serve --port=8080
    healthcheck:
      test: curl --fail -s http://localhost:8080 || exit 1
      interval: 15s
      timeout: 3s
      retries: 3
      start_period: 30s
networks:
  base:
secrets:
  # see https://docs.docker.com/engine/swarm/secrets/#build-support-for-docker-secrets-into-your-images
  host_ssh_key:
    file: ~/.ssh/id_rsa
